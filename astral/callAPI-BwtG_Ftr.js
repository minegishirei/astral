class u extends Error{}u.prototype.name="InvalidTokenError";function w(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,s)=>{let o=s.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}function m(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return w(e)}catch{return atob(e)}}function d(t,e){if(typeof t!="string")throw new u("Invalid token specified: must be a string");e||(e={});const s=e.header===!0?0:1,o=t.split(".")[s];if(typeof o!="string")throw new u(`Invalid token specified: missing part #${s+1}`);let i;try{i=m(o)}catch(n){throw new u(`Invalid token specified: invalid base64 for part #${s+1} (${n.message})`)}try{return JSON.parse(i)}catch(n){throw new u(`Invalid token specified: invalid json for part #${s+1} (${n.message})`)}}const h=window.location.origin+"/",g="4a8e6va0e6k1l8gqp6r48cesgu",p="dev-astral",$=t=>{if(t&&t!=="undefined"){const e=d(t);if(!e.exp)return!1;console.log(e.exp);const s=Math.floor(Date.now()/1e3);return e.exp>s}return!1},S=t=>{try{return d(t)}catch(e){console.error("Invalid token:",e)}return{"cognito:username":""}},_=()=>new URLSearchParams(window.location.search).get("code"),y=()=>`https://${p}.auth.ap-northeast-1.amazoncognito.com/login?client_id=${g}&response_type=code&scope=email+openid+profile&redirect_uri=${h}`,z=async t=>{const e=await fetch(`https://${p}.auth.ap-northeast-1.amazoncognito.com/oauth2/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=authorization_code&client_id=${g}&code=${t}&redirect_uri=${h}`}),s=await e.json();return e.ok&&s.id_token?(localStorage.setItem("token",s.id_token),s):{id_token:""}},I=async(t=!0)=>{const e=localStorage.getItem("token");if($(e))return console.log("Token already exists and is valid"),{id_token:e};const s=_();return s?await z(s):t?(window.location.href=y(),Promise.resolve({id_token:""})):{id_token:""}},r="https://d2880sy3aqy51t.cloudfront.net";console.log(r);const k=window.location.origin+"/",A="4a8e6va0e6k1l8gqp6r48cesgu",P="dev-astral",a=()=>{const t=`https://${P}.auth.ap-northeast-1.amazoncognito.com/login?client_id=${A}&response_type=code&scope=email+openid+profile&redirect_uri=${k}`;window.location.href=t},T=async(t,e)=>{const o=`${r}/api/network?${(l=>new URLSearchParams(Object.entries(l).filter(([,c])=>c!=null).map(([c,f])=>[c,String(f)])).toString())(e)}`;console.log(o);const n=await(await fetch(o,{method:"GET",headers:{Authorization:`Bearer ${t}`}})).json();return n.message==="unauthorized"&&a(),console.log(n),n},j=async(t,e)=>{console.log(e);const o=await(await fetch(`${r}/api/user_network?user_id=${e.user_id}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}})).json();return o.message==="unauthorized"&&a(),console.log(o),o},E=async(t,e)=>{const o=await(await fetch(`${r}/api/node?user_id=${e.user_id}`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).json();return o.message==="unauthorized"&&a(),console.log(o),o},v=async(t,e)=>{console.log(e);const s=e.query===void 0?"":`?query=${e.query}`,o=e.title===void 0?"":`?title=${e.title}`,n=await(await fetch(`${r}/api/node${s}${o}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}})).json();return n.message==="unauthorized"&&a(),console.log(n),n},O=async(t,e)=>{console.log(e);const s=e.source===void 0?"":`?source=${e.source}`,o=e.target===void 0?"":`&target=${e.target}`,n=await(await fetch(`${r}/api/fiber${s}${o}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}})).json();return n.message==="unauthorized"&&a(),console.log(n),n},U=async(t,e)=>{console.log(e);const s=e.query===void 0?"":`?query=${e.query}`,o=e.title===void 0?"":`?title=${e.title}`,n=await(await fetch(`${r}/api/article${s}${o}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}})).json();return n.message==="unauthorized"&&a(),console.log(n),n},B=async(t,e)=>{console.log(e);const o=await(await fetch(`${r}/api/article`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).json();return o.message==="unauthorized"&&a(),console.log(o),o},q=async(t,e)=>{console.log(e);const o=await(await fetch(`${r}/api/link`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).json();return o.message==="unauthorized"&&a(),console.log(o),o},G=async(t,e)=>{console.log(e);const o=await(await fetch(`${r}/api/link?page=${e.page}&user_id=${e.user_id}`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).json();return o.message==="unauthorized"&&a(),console.log(o),o},L=async(t,e)=>{console.log(e);const o=await(await fetch(`${r}/api/likes`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).json();return o.message==="unauthorized"&&a(),console.log(o),o},N=async(t,e)=>{console.log(e);const o=await(await fetch(`${r}/api/link_likes`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).json();return o.message==="unauthorized"&&a(),console.log(o),o},D=async(t,e)=>{console.log(e);const o=await(await fetch(`${r}/api/likes?user_id=${e.user_id}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}})).json();return o.message==="unauthorized"&&a(),console.log(o),o},J=async(t,e)=>{console.log(e);const o=await(await fetch(`${r}/api/user`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).json();return o.message==="unauthorized"&&a(),console.log(o),o},R=async(t,e)=>{console.log(e);const o=await(await fetch(`${r}/api/user`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).json();return o.message==="unauthorized"&&a(),console.log(o),o},x=async(t,e)=>{console.log(e);const i=await(await fetch(`${r}/api/user?${(n=>new URLSearchParams(Object.entries(n).map(([l,c])=>[l,String(c)])).toString())(e)}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}})).json();return i.message==="unauthorized"&&a(),console.log(i),i},C=async(t,e)=>{console.log(e);const o=await(await fetch(`${r}/api/user_follow`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).json();return o.message==="unauthorized"&&a(),o.message==="Unauthorized"&&a(),console.log(o),o},F=async(t,e)=>{console.log(e);const o=await(await fetch(`${r}/api/user_follow`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).json();return o.message==="unauthorized"&&a(),console.log(o),o},V=async(t,e)=>{console.log(e);const i=await(await fetch(`${r}/api/user_follow?${(n=>new URLSearchParams(Object.entries(n).map(([l,c])=>[l,String(c)])).toString())(e)}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}})).json();return i.message==="unauthorized"&&a(),console.log(i),i},M=async(t,e)=>{console.log(e);const i=await(await fetch(`${r}/api/notification?${(n=>new URLSearchParams(Object.entries(n).map(([l,c])=>[l,String(c)])).toString())(e)}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}})).json();return i.message==="unauthorized"&&a(),console.log(i),i};export{M as a,N as b,x as c,S as d,C as e,F as f,I as g,O as h,v as i,E as j,G as k,T as l,D as m,j as n,B as o,q as p,L as q,U as r,V as s,J as t,R as u,$ as v};
